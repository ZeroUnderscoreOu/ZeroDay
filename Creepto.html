<HTML>
<Head>
	<Meta Charset=UTF-8>
	<Style>
		Body {
			Width: 70%;
			Margin-Left: 15%;
		}
		Img {
			Width: 200px;
			Height: 200px;
		}
		Table {
			Border-Collapse: Collapse;
		}
		TD {
			Border: 1px Solid Black;
			Padding: 10px;
		}
		Form {
			Margin: 25px 0px 25px 0px;
		}
		Input[Type=Text] {
			Width: 200px;
			Margin: 0px 10px 0px 10px;
		}
		Input[Type=Submit] {
			Width: 100px;
			Height: 25px;
		}
	</Style>
	<Script>
		"use stict";

		var Link = new URL("https://api.cryptokitties.co/auctions");
		var LinkKitty = "https://www.cryptokitties.co/kitty/";
		var Speed = ["Fast","Swift","Swift","Snappy","Snappy","Brisk","Brisk","Plodding","Plodding","Slow","Slow","Sluggish","Sluggish","Catatonic"];
		var Ether = 1000000000000000000;
		var Offset = 0;
		Link.searchParams.set("limit",100);
		Link.searchParams.set("type","sale");
		Link.searchParams.set("status","open");
		Link.searchParams.set("sorting","cheap");
		Link.searchParams.set("orderBy","current_price");
		Link.searchParams.set("orderDirection","asc");
		//https://api.cryptokitties.co/kitties/93863

		function SearchUpdate() {
			ButtonLoad.disabled = false; // enabling the button if it was locked
			ButtonLoad.value = "Load";
			TextSearch.removeEventListener("input",SearchUpdate);
		};

		function LoadKitties(Event) {
			Event.preventDefault();
			if (TextSearch.value.length>0) {
				if (Link.searchParams.get("search")!=TextSearch.value) { // resetting
					Offset = 0;
					Array.from(Table.rows).forEach((Row)=>{Row.remove();});
					Link.searchParams.set("search",TextSearch.value);
				};
			} else {
				Link.searchParams.delete("search");
			};
			Link.searchParams.set("offset",Offset);
			fetch(Link).then((Data)=>(Data.json())).then((Data)=>{
				let Fragment = new DocumentFragment();
				Data.auctions.forEach((Cat)=>{
					if (Cat.kitty.status.cooldown_index>8) { // too slow
						return;
					};
					let Row = document.createElement("TR");
					let A = document.createElement("A");
					A.href = `${LinkKitty}${Cat.kitty.id}`;
					A.textContent = `${Cat.kitty.name}`
					Row.append(document.createElement("TD"),document.createElement("TD"),document.createElement("TD"));
					Row = Row.childNodes;
					Row[0].appendChild(document.createElement("Img")).src = Cat.kitty.image_url;
					Row[1].append(`G${Cat.kitty.generation} ${Speed[Cat.kitty.status.cooldown_index]} `,A);
					Row[2].textContent = `${(parseFloat(Cat.current_price)/Ether).toFixed(8)}`; // I'm too lazy to dig into CK's code; that's how I understand their convertion of JSON data
					Fragment.append(Row[0].parentElement);
				});
				Table.append(Fragment);
				Offset += 100;
				if (Offset>=Data.total) { // reached the end of the list
					ButtonLoad.disabled = true;
					ButtonLoad.value = "That's all";
					TextSearch.addEventListener("input",SearchUpdate);
				};
			});
		};
	</Script>
</Head>
<Body>
	<Table Id=List></Table>
	<Form Id=KittieSearch>
		<Input Id=TextSearch Type=Text Placeholder=Search>
		<Input Id=ButtonLoad Type=Submit Value=Load>
	<Form>
	<Script>
		var Table = document.getElementById("List");
		var KittieSearch = document.getElementById("KittieSearch");
		var TextSearch = document.getElementById("TextSearch");
		var ButtonLoad = document.getElementById("ButtonLoad");
		KittieSearch.addEventListener("submit",LoadKitties);
	</Script>
</Body>
</HTML>